<%- include("../partials/header") %>

<div id="dashboard-container">
    <div id=testing>
      <% if (currentUser) { %>
        <h4><%= currentUser %></h4>
        <a href="/stocks/<%=currentUser._id%>/new">Add new stock</a>
        <% stocks.forEach(function(stock){ %>
          <h4><%=stock.name%>
              <a href="/stocks/<%=currentUser._id%>/<%=stock._id%>" class="btn btn-primary">More Info</a>
          </h4>
        <% }); %>
      <% } %>
      
    </div>
    
    <div id="tracked-stocks">
        <h1>Tracked Stocks <i class="fa fa-plus"></i></h1>
        <input type="text" placeholder="Search stock by tick symbol">

        <table id="tracked-stock-table" class="table table-hover">
            <thead>
              <tr>
                <th scope="col">Name</th>
                <th scope="col">Tick Symbol</th>
                <th scope="col">Current Price</th>
                <th scope="col">Change(%)</th>
                <th scope="col">Change(USD)</th>
                <th scope="col">Graph Option</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row"><span><i class="fa fa-trash"></i></span>APPLE</th>
                <td>APL</td>
                <td>20.5</td>
                <td>0.5</td>
                <td>10</td>
                <td><input type="checkbox"></td>
              </tr>
              <tr>
                <th scope="row"><span><i class="fa fa-trash"></i></span>APPLE</th>
                <td>APL</td>
                <td>20.5</td>
                <td>0.5</td>
                <td>10</td>
                <td><input type="checkbox"></td>
              </tr>
            </tbody>
        </table>
    </div>

    <!-- <div id="graph-button">
        <button type="button" class="btn custom-graph-btn">Graph</button>
    </div> -->

    <div id="graphs">
        <h1>Graphs</h1>
        <canvas id="chart"></canvas>
        <script>
          chartIt();
          function chartIt () {
            const data = JSON.parse('<%- JSON.stringify(datapoints) %>');
            const xs = [];
            const ys = [];
            data.forEach(stock => {
              xs.push(stock.label);
              ys.push(stock.y);
            });
              const ctx = document.getElementById('chart').getContext('2d');
              ctx.canvas.width = 1000
              ctx.canvas.height = 300
              const chart = new Chart(ctx, {
                  type: 'line',
                  data: {
                      labels: xs,
                      datasets: [{
                          label: 'Stock Price of IBM',
                          data: ys,
                          borderColor: ['rgba(75, 192, 192)'],
                          borderWidth: 2,
                          fill: false,
                          lineTension: 0,
                          pointRadius: 0.5
                      }]
                  },
                  options: {
                      scales: {
                          yAxes: [{
                              ticks: {
                                  callback: function (value, index, values) {
                                      return value + '$';
                                  },
                                  // stepSize: 1,
                              },
                              scaleLabel: {
                                  display: true,
                                  labelString: 'Openning Price ($)'
                              }
                          }],
                          xAxes: [{
          
                          }]
                      },
                  }
              });
          }    
          </script>
    </div>
</div>

<%- include("../partials/footer") %>