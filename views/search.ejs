<link
  rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
  integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
  crossorigin="anonymous"
/>

<style>
.search-item {
  display: block;
  width: 100%;
  padding: .5rem 1rem;
  clear: both;
  font-weight: 400;
  color: #212529;
  text-align: inherit;
  white-space: nowrap;
  background-color: white;
  border-top: 1px solid #dee2e6;;
}
.search-item:hover, .chosen {
  background-color: rgb(235, 235, 235);
}

</style>

<input id="searchStock" type="text" placeholder="Search stock by tick symbol" />
<div id="searchResult"></div>
<button class="d-block">Submit</button>

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"
></script>

<script
  src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
  integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
  crossorigin="anonymous"
></script>

<script>
  var searchResult = document.getElementById("searchResult");
  var searchStock = document.getElementById("searchStock");
  
  $("#searchStock").keyup(function (event) {
    if (event.which == 8 || (event.which >= 65 && event.which <= 90)) {
      // $("#searchResult").removeClass("d-none");
      $("#searchResult").show();

      var searchTerm = $(this).val().toUpperCase();
      searchQuery(searchTerm);
    }
  });

  $("#searchResult").delegate('div', 'click', function (event) {
    var found = $(this).text();
    searchStock.value = found.split("-")[0].trim();
    $(this).addClass("chosen").siblings().removeClass("chosen");
    $(this).parent().hide();
    // $(this).parent().addClass("d-none");
  })

  function searchQuery(searchTerm) {
    var url = "http://localhost:3000/search";
    var params = "searchTerm=" + searchTerm;
    var http = new XMLHttpRequest();
    http.open("POST", url, true);
    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    http.onreadystatechange = function () {
      if (http.readyState == 4 && http.status == 200) {
        var obj = http.responseText;
        var parsed = JSON.parse(obj);
        var found = parsed.foundStock;
        if (found.length == 0) {
          // searchResult.innerHTML = "Can't find stock, search another term";
          searchResult.innerHTML = "<div class=\"empty-mes\">Can't find stock, search another term </div>";
        } else {
          searchResult.innerHTML = "";
          renderHTML(found);
        }
      }
    };
    http.send(params);
  }
  function renderHTML(found) {
    var htmlString = "";
    for (i = 0; i < found.length; i++) {
      if (i == 10) {
        break;
      }
      htmlString += "<div class=\"search-item\">" + found[i].symbol + " - " + found[i].name + " </div>";
    }
    searchResult.innerHTML = htmlString;
  }
</script>
